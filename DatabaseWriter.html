<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AZ-Reporter Writer</title>
    <style>
        h1{
            font-family: Verdana;
            font-size: 18px;
        }
        .form{
            display: block;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="form">
        <h1>AZ-Reporter - Registre um Report</h1><br>

        <label for="input_sys_type">Selecionar Empresa</label><br>
        <select id="input_sys_type" name="input_sys_type">
        </select><br><br>

        <label for="input_itens_empresa">Selecionar Empresa</label><br>
        <select id="input_itens_empresa" name="input_itens_empresa">
            <!--
            <option>UnidadesControle</option>
            <option>VMWares</option>
            -->
        </select><br><br>

        <button id="btnEnviar">Enviar</button>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {

            //<select id="input_sys_type" name="input_sys_type">
            let SelectEmpresa = document.getElementById('input_sys_type');
            SelectEmpresa.addEventListener('change', function() {
                SelectEmpresa = document.getElementById('input_sys_type');
                console.log("Empresa selecionada: ", SelectEmpresa.value);
            });

            fetch('./data/json/reportsbase.json').then((response) => response.json()).then((Reports) => {

                Object.keys(Reports).forEach((empresa) =>{ //console.log("empresa....: ", empresa); // equivale a: brk: {
                    //<option>empresa</option>
                    const option_empresa = document.createElement('option');
                    option_empresa.textContent = empresa;
                    SelectEmpresa.appendChild(option_empresa);
                });

                console.log("SelectEmpresa.value: ", SelectEmpresa.value);

                Object.keys(Reports).forEach((empresa) =>{



                    console.log("item: ", empresa);
                    console.log("item[SelectedValue]: ", empresa[SelectEmpresa.value]);




                });
                

                // Object.keys(reports).forEach((empresa) =>{ //console.log("empresa....: ", empresa); // equivale a: brk: {

                //     Object.keys(reports[empresa]).forEach((itemEmpresa) =>{ //console.log("  itensEmpresa: ", itemEmpresa); //equivale a UnidadesControle: {


                //     });
                // });
                

  
            });
            
            const btnEnviar = document.getElementById('btnEnviar');

            function enviarDados() {

                const data = {};

                const inputs = document.querySelectorAll('[id^="input_"]');
                console.log("all_inputs: ", inputs);
                inputs.forEach((input, index) =>{
                    console.log("input_id:", input.id, "| index:", index, "| input_value:", input.value);
                    data[input.id.match(/input_(.+)/)[1]] = input.value;
                });

                fetch('http://localhost:8083/newcommand', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                }).then(response =>{
                    if(!response.ok) {
                        throw new Error('Erro ao enviar dados');
                    }
                    return response.json();
                }).then(data => {
                    console.log('Dados enviados com sucesso: ', data);
                }).catch(error => {
                    console.log("Error: ", error);
                });
            };

            btnEnviar.addEventListener('click', enviarDados);

        });
    </script>
</body>
</html>